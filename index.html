<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Make Your Own Microbe</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .download-btn { padding: 10px 20px; font-size: 1rem; margin-top: 20px; }
    .summary-card { border: 1px solid #ccc; padding: 20px; margin-top: 20px; }
  </style>
</head>
<body>
  <h1>ðŸŽ‰ Your Microbe Design Complete!</h1>

  <div class="summary-card" id="summary"></div>

  <button id="downloadBtn" class="download-btn">ðŸ“„ Download Word Document</button>

  <script>
    // Clear state for user-driven input
    const state = {
      name: '',
      microbeType: '',
      traits: {},
      transmission: '',
      transmissionDetail: '',
      portalOfEntry: '',
      reproduction: '',
      adaptations: [],
      toxinType: '',
      toxinSubtype: '',
      customEnzyme: '',
      enzymeFunction: '',
      symptoms: ''
    };

    function renderSummary() {
      let adaptationText = state.adaptations.join(', ');
      if (state.toxinType) {
        let toxinDisplay = state.toxinType;
        if (state.toxinSubtype) {
          toxinDisplay += ` (${state.toxinSubtype})`;
        }
        adaptationText = adaptationText.replace('Toxin secretion', `Toxin secretion (${toxinDisplay})`);
      }
      if (state.customEnzyme) {
        adaptationText = adaptationText.replace('Enzyme production', `Enzyme production (${state.customEnzyme}: ${state.enzymeFunction})`);
      }

      const traitsMarkup = Object.entries(state.traits)
        .map(([k, v]) => `<p><strong>${k}:</strong> ${v}</p>`).join('');

      document.getElementById('summary').innerHTML = `
        <h3>${state.name || '(Name Missing)'}</h3>
        <p><strong>Type:</strong> ${state.microbeType || '(Not selected)'}</p>
        ${traitsMarkup}
        <p><strong>Transmission:</strong> ${state.transmission} - ${state.transmissionDetail}</p>
        <p><strong>Portal of Entry:</strong> ${state.portalOfEntry}</p>
        <p><strong>Reproduction:</strong> ${state.reproduction}</p>
        <p><strong>Adaptations:</strong> ${adaptationText}</p>
        <p><strong>Symptoms:</strong> ${state.symptoms}</p>
      `;
    }

    function downloadWordDocument() {
      try {
        let adaptationText = state.adaptations.join(', ');
        if (state.toxinType) {
          let toxinDisplay = state.toxinType;
          if (state.toxinSubtype) {
            toxinDisplay += ` (${state.toxinSubtype})`;
          }
          adaptationText = adaptationText.replace('Toxin secretion', `Toxin secretion (${toxinDisplay})`);
        }
        if (state.customEnzyme) {
          adaptationText = adaptationText.replace('Enzyme production', `Enzyme production (${state.customEnzyme}: ${state.enzymeFunction})`);
        }

        const rtfContent = `{\\rtf1\\ansi\\deff0 {\\fonttbl {\\f0 Times New Roman;}}
\\f0\\fs24 
\\qc\\b\\fs32 Make Your Own Microbe - Design Summary\\b0\\fs24\\par
\\par
\\par
Student Name: _________________________    Date: _________________________\\par
\\par
\\par
\\b\\fs28 Microbe Name: ${state.name || '(Name Missing)'}\\b0\\fs24\\par
\\par
\\b\\fs20 Basic Characteristics\\b0\\par
\\par
Microbe Type: ${state.microbeType || '(Not selected)'}\\par
${Object.entries(state.traits).map(([k, v]) => `${k.charAt(0).toUpperCase() + k.slice(1)}: ${v}\\par`).join('')}
\\par
\\b\\fs20 Transmission and Entry\\b0\\par
\\par
Transmission Method: ${state.transmission} - ${state.transmissionDetail}\\par
Portal of Entry: ${state.portalOfEntry}\\par
\\par
\\b\\fs20 Reproduction and Survival\\b0\\par
\\par
Reproduction Method: ${state.reproduction}\\par
Adaptations: ${adaptationText}\\par
\\par
\\b\\fs20 Disease Manifestation\\b0\\par
\\par
Predicted Symptoms: ${state.symptoms}\\par
\\par
\\par
\\b\\fs20 Instructor Comments:\\b0\\par
\\par
\\par
\\par
\\par}`;

        const blob = new Blob([rtfContent], { type: 'application/msword' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${(state.name || 'Microbe_Design').replace(/[^a-zA-Z0-9]/g, '_')}.doc`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        console.log("Download triggered.");
      } catch (e) {
        console.error("Download failed:", e);
        alert("Sorry, the download did not work. Try copying the summary manually.");
      }
    }

    document.getElementById("downloadBtn").addEventListener("click", downloadWordDocument);
    renderSummary();
  </script>
</body>
</html>
